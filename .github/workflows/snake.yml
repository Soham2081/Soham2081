# Generate GitHub contribution "snake" SVG and push it to a branch named `output`.
# Runs every 6 hours and can be triggered manually.
name: Generate Snake

on:
  workflow_dispatch: {}
  schedule:
    # every 6 hours
    - cron: '0 */6 * * *'

permissions:
  contents: write

jobs:
  generate-snake:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Prepare workspace
        run: |
          mkdir -p output

      - name: Generate SVG with github-contribution-grid-snake
        # stable CLI approach (no action input-name uncertainty)
        run: npx github-contribution-grid-snake --username Soham2081 --output ./output/github-contribution-grid-snake.svg

      - name: Debug: show generated file
        run: |
          echo "Contents of output/:"
          ls -la output || true
          if [ -f output/github-contribution-grid-snake.svg ]; then
            echo "SVG exists; show head:"
            head -n 20 output/github-contribution-grid-snake.svg
          else
            echo "SVG not found after generation."
            exit 1
          fi

      - name: Commit and push to output branch
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          # create/update the output branch and put the SVG at repository root so the URL is:
          # https://github.com/<owner>/<repo>/blob/output/github-contribution-grid-snake.svg
          git checkout -B output
          # copy the generated file to repo root (file will live at repo root on branch `output`)
          cp -f output/github-contribution-grid-snake.svg ./github-contribution-grid-snake.svg
          git add ./github-contribution-grid-snake.svg
          # commit only if changed
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "chore: update contribution snake"
          fi
          # force push the output branch (safe for a dedicated output branch)
          git push --force --set-upstream origin output
